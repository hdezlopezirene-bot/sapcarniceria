<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dashboard Inventario — Cámara Frigorífica</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #f8fafc;
      --card-bg: #ffffff;
      --border: #e2e8f0;
      --text-strong: #0f172a;
      --text-normal: #334155;
      --text-muted: #64748b;
      --accent: #1e40af;
      --accent-light: #3b82f6;
      --accent-bg: #eff6ff;
      --ok: #059669;
      --warn: #d97706;
      --alert: #dc2626;
      --sidebar-width: 240px;
      --header-height: 64px;
      --bottom-nav-height: 70px;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --radius: 8px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      display: flex;
      height: 100vh;
      background: var(--bg);
      color: var(--text-normal);
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      font-weight: 400;
      line-height: 1.5;
      padding-bottom: var(--bottom-nav-height);
    }

    /* Sidebar */
    .sidebar {
      width: var(--sidebar-width);
      background: var(--card-bg);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      box-shadow: var(--shadow);
      z-index: 10;
    }

    .logo {
      padding: 20px 16px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-icon {
      width: 32px;
      height: 32px;
      background: var(--accent);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
    }

    .logo-text {
      font-weight: 700;
      font-size: 18px;
      color: var(--text-strong);
    }

    .nav-menu {
      flex: 1;
      padding: 16px 0;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      color: var(--text-muted);
      cursor: pointer;
      transition: all 0.2s;
      border-left: 3px solid transparent;
    }

    .nav-item:hover {
      background: var(--accent-bg);
      color: var(--accent);
    }

    .nav-item.active {
      background: var(--accent-bg);
      color: var(--accent);
      border-left-color: var(--accent);
      font-weight: 500;
    }

    .nav-item i {
      width: 20px;
      height: 20px;
    }

    /* Main content */
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .header {
      height: var(--header-height);
      background: var(--card-bg);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 24px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    }

    .header-title {
      font-size: 20px;
      font-weight: 600;
      color: var(--text-strong);
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .user-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: var(--accent);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 500;
    }

    .content {
      flex: 1;
      overflow: auto;
      padding: 24px;
    }

    /* Bottom Navigation */
    .bottom-nav {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      height: var(--bottom-nav-height);
      background: var(--card-bg);
      border-top: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-around;
      padding: 8px 12px;
      box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
      z-index: 100;
    }

    .nav-btn {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 8px 4px;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
      color: var(--text-muted);
      min-height: 54px;
    }

    .nav-btn:hover {
      background: var(--accent-bg);
      color: var(--accent);
    }

    .nav-btn.active {
      color: var(--accent);
      background: var(--accent-bg);
    }

    .nav-btn i {
      width: 20px;
      height: 20px;
      margin-bottom: 4px;
    }

    .nav-btn div {
      font-size: 11px;
      font-weight: 500;
      text-align: center;
    }

    .nav-btn.active div {
      font-weight: 600;
    }

    /* Cards */
    .card {
      background: var(--card-bg);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 20px;
      margin-bottom: 20px;
      transition: transform 0.2s, box-shadow 0.2s;
      border: 1px solid var(--border);
    }

    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .card-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-strong);
    }

    .card-actions {
      display: flex;
      gap: 8px;
    }

    .btn {
      padding: 6px 12px;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: var(--card-bg);
      color: var(--text-normal);
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .btn:hover {
      background: var(--accent-bg);
      color: var(--accent);
      border-color: var(--accent-light);
    }

    .btn-primary {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }

    .btn-primary:hover {
      background: var(--accent-light);
    }

    /* Tabs */
    .tab {
      display: none;
    }

    .tab.active {
      display: block;
    }

    /* Stats */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }

    .stat-card {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 16px;
      box-shadow: var(--shadow);
      border-left: 4px solid var(--accent);
      transition: transform 0.2s;
      cursor: pointer;
    }

    .stat-card:hover {
      transform: translateY(-2px);
    }

    .stat-value {
      font-size: 24px;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 4px;
    }

    .stat-label {
      font-size: 14px;
      color: var(--text-muted);
    }

    /* Chips */
    .chip-box {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 16px;
    }

    .chip {
      padding: 6px 12px;
      border-radius: 16px;
      border: 1px solid var(--border);
      background: var(--card-bg);
      cursor: pointer;
      color: var(--text-muted);
      transition: all 0.15s;
      font-size: 13px;
    }

    .chip.active {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }

    /* Table */
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }

    th, td {
      padding: 12px 16px;
      border-bottom: 1px solid var(--border);
      text-align: left;
    }

    th {
      background: var(--accent-bg);
      color: var(--text-strong);
      cursor: pointer;
      font-weight: 500;
      position: relative;
    }

    tr:hover {
      background: #f8fafc;
    }

    th.sort-asc::after {
      content: " ▲";
      font-size: 11px;
      position: absolute;
      right: 8px;
    }

    th.sort-desc::after {
      content: " ▼";
      font-size: 11px;
      position: absolute;
      right: 8px;
    }

    /* Charts */
    .charts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .chart-container {
      position: relative;
      height: 300px;
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 16px;
      box-shadow: var(--shadow);
    }

    canvas {
      width: 100% !important;
      height: 100% !important;
    }

    /* Status indicators */
    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }

    .status-low {
      background: #fef2f2;
      color: var(--alert);
    }

    .status-medium {
      background: #fffbeb;
      color: var(--warn);
    }

    .status-good {
      background: #f0fdf4;
      color: var(--ok);
    }

    .status-safe {
      background: #eff6ff;
      color: var(--accent);
    }

    /* Expiration indicators */
    .exp-red {
      color: var(--alert);
      font-weight: 600;
    }

    .exp-orange {
      color: var(--warn);
      font-weight: 600;
    }

    .exp-green {
      color: var(--ok);
      font-weight: 600;
    }

    .exp-safe {
      color: var(--accent-light);
      font-weight: 600;
    }

    /* Accordion */
    .accordion {
      overflow: hidden;
      max-height: 0;
      transition: max-height 0.3s ease;
    }

    .accordion.open {
      max-height: 400px;
    }

    .accordion ul {
      margin: 8px 0 0;
      padding-left: 18px;
      color: var(--text-normal);
    }

    /* Hamburger Menu */
    .hamburger-menu {
      position: relative;
    }

    .hamburger-btn {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      width: 24px;
      height: 18px;
      background: none;
      border: none;
      cursor: pointer;
      padding: 0;
    }

    .hamburger-btn span {
      display: block;
      height: 2px;
      width: 100%;
      background-color: var(--text-strong);
      transition: all 0.3s ease;
    }

    .dropdown-menu {
      position: absolute;
      top: 100%;
      right: 0;
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      width: 200px;
      padding: 8px 0;
      z-index: 1000;
      display: none;
    }

    .dropdown-menu.active {
      display: block;
    }

    .dropdown-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 16px;
      color: var(--text-normal);
      cursor: pointer;
      transition: all 0.2s;
    }

    .dropdown-item:hover {
      background: var(--accent-bg);
      color: var(--accent);
    }

    .dropdown-item i {
      width: 16px;
      height: 16px;
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .sidebar {
        width: 200px;
      }
    }

    @media (max-width: 768px) {
      .sidebar {
        display: none;
      }
      
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .charts-grid {
        grid-template-columns: 1fr;
      }
      
      .bottom-nav {
        display: flex;
      }
    }

    @media (max-width: 480px) {
      .stats-grid {
        grid-template-columns: 1fr;
      }
      
      .header {
        padding: 0 16px;
      }
      
      .content {
        padding: 16px;
      }
      
      .nav-btn div {
        font-size: 10px;
      }
    }

    @media (min-width: 769px) {
      .bottom-nav {
        display: none;
      }
    }
  </style>
</head>
<body>
  <!-- Sidebar Navigation -->
  <div class="sidebar">
    <div class="logo">
      <div class="logo-icon">
        <i data-lucide="package"></i>
      </div>
      <div class="logo-text">Inventario</div>
    </div>
    
    <div class="nav-menu">
      <div class="nav-item active" data-tab="graficos">
        <i data-lucide="bar-chart-2"></i>
        <span>Análisis Gráfico</span>
      </div>
      <div class="nav-item" data-tab="stock">
        <i data-lucide="package"></i>
        <span>Control de Stock</span>
      </div>
      <div class="nav-item" data-tab="recs">
        <i data-lucide="lightbulb"></i>
        <span>Alertas y Sugerencias</span>
      </div>
      <div class="nav-item" data-tab="ventas">
        <i data-lucide="shopping-cart"></i>
        <span>Ventas y Tendencias</span>
      </div>
      <div class="nav-item" data-tab="resumen">
        <i data-lucide="pie-chart"></i>
        <span>Resumen General</span>
      </div>
    </div>
    
    <div style="padding: 16px; border-top: 1px solid var(--border);">
      <div class="user-info">
        <div class="user-avatar">DR</div>
        <div>
          <div style="font-weight: 500; font-size: 14px;">Jefe de Stock</div>
          <div style="font-size: 12px; color: var(--text-muted);">Cámara Frigorífica</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <div class="header">
      <div class="header-title" id="title">Dashboard de Inventario</div>
      <div style="display: flex; gap: 12px; align-items: center;">
        <div style="font-size: 14px; color: var(--text-muted);">06/10/2025</div>
        <div class="btn" id="exportExcelBtn">
          <i data-lucide="download"></i>
          <span>Exportar Excel</span>
        </div>
        <div class="hamburger-menu">
          <button class="hamburger-btn" id="hamburgerBtn">
            <span></span>
            <span></span>
            <span></span>
          </button>
          <div class="dropdown-menu" id="dropdownMenu">
            <div class="dropdown-item">
              <i data-lucide="settings"></i>
              <span>Mantenedor</span>
            </div>
            <div class="dropdown-item">
              <i data-lucide="key"></i>
              <span>Cambio Contraseña</span>
            </div>
            <div class="dropdown-item">
              <i data-lucide="log-out"></i>
              <span>Logout</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="content">
      <!-- GRÁFICOS -->
      <section id="tab-graficos" class="tab active">
        <div class="charts-grid">
          <div class="chart-container">
            <canvas id="chartBar"></canvas>
          </div>
          <div class="chart-container">
            <canvas id="chartPie"></canvas>
          </div>
        </div>
        <div class="card">
          <div class="card-header">
            <div class="card-title">Evolución de Consumo</div>
          </div>
          <div class="chart-container">
            <canvas id="chartLine"></canvas>
          </div>
        </div>
      </section>

      <!-- STOCK -->
      <section id="tab-stock" class="tab">
        <div class="card">
          <div class="card-header">
            <div class="card-title">Control de Stock</div>
            <div class="card-actions">
              <div class="btn">
                <i data-lucide="plus"></i>
                <span>Nuevo Producto</span>
              </div>
              <div class="btn">
                <i data-lucide="refresh-cw"></i>
                <span>Actualizar</span>
              </div>
            </div>
          </div>

          <div class="chip-box" id="chips">
            <div class="chip active" data-filter="Todos">Todos</div>
            <div class="chip" data-filter="Cámara">Cámara</div>
            <div class="chip" data-filter="Congelador Grande">Congelador Grande</div>
            <div class="chip" data-filter="Congelador Chico">Congelador Chico</div>
            <div class="chip" data-filter="Vitrina">Vitrina</div>
          </div>

          <div style="overflow-x: auto;">
            <table>
              <thead>
                <tr>
                  <th data-key="producto">Producto</th>
                  <th data-key="kilos">Kilos</th>
                  <th data-key="venc">Vencimiento</th>
                  <th data-key="ubicacion">Ubicación</th>
                  <th>Estado</th>
                </tr>
              </thead>
              <tbody id="stockBody"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- RECOMENDACIONES -->
      <section id="tab-recs" class="tab">
        <div id="recList"></div>
      </section>

      <!-- VENTAS -->
      <section id="tab-ventas" class="tab">
        <div class="card">
          <div class="card-header">
            <div class="card-title">Productos Más Vendidos</div>
          </div>
          <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px;">
            <div class="status-badge status-good">Pulpa cerdo</div>
            <div class="status-badge status-good">Posta Paleta</div>
            <div class="status-badge status-good">Sobre costilla</div>
            <div class="status-badge status-good">Posta negra</div>
            <div class="status-badge status-good">Posta rosada</div>
            <div class="status-badge status-good">Asiento</div>
            <div class="status-badge status-good">Palanca</div>
            <div class="status-badge status-good">Pechuga entera agro</div>
            <div class="status-badge status-good">Aviones de pollo</div>
            <div class="status-badge status-good">Pollo trozado</div>
          </div>
        </div>
        
        <div class="card">
          <div class="card-header">
            <div class="card-title">Tendencias de Ventas</div>
          </div>
          <div class="chart-container">
            <canvas id="chartSales"></canvas>
          </div>
        </div>
      </section>

      <!-- RESUMEN -->
      <section id="tab-resumen" class="tab">
        <div class="stats-grid">
          <div class="stat-card" data-type="total">
            <div class="stat-value" id="total-products">0</div>
            <div class="stat-label">Total Productos</div>
            <div class="accordion" id="accordion-total"></div>
          </div>
          <div class="stat-card" data-type="low-stock">
            <div class="stat-value" id="low-stock">0</div>
            <div class="stat-label">Stock Bajo</div>
            <div class="accordion" id="accordion-low-stock"></div>
          </div>
          <div class="stat-card" data-type="expiring-soon">
            <div class="stat-value" id="expiring-soon">0</div>
            <div class="stat-label">Próximos a Vencer</div>
            <div class="accordion" id="accordion-expiring-soon"></div>
          </div>
          <div class="stat-card" data-type="new-today">
            <div class="stat-value" id="new-today">0</div>
            <div class="stat-label">Ingresados Hoy</div>
            <div class="accordion" id="accordion-new-today"></div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-title">Resumen de Inventario</div>
          </div>
          <div class="stats" id="statsBox"></div>
        </div>
      </section>
    </div>
  </div>

  <!-- Bottom Navigation -->
  <div class="bottom-nav" role="navigation" aria-label="Navegación principal">
    <div class="nav-btn active" data-tab="graficos">
      <i data-lucide="bar-chart-2"></i>
      <div>Gráficos</div>
    </div>
    <div class="nav-btn" data-tab="stock">
      <i data-lucide="package"></i>
      <div>Stock</div>
    </div>
    <div class="nav-btn" data-tab="recs">
      <i data-lucide="lightbulb"></i>
      <div>Alertas</div>
    </div>
    <div class="nav-btn" data-tab="ventas">
      <i data-lucide="shopping-cart"></i>
      <div>Ventas</div>
    </div>
    <div class="nav-btn" data-tab="resumen">
      <i data-lucide="pie-chart"></i>
      <div>Resumen</div>
    </div>
  </div>

  <script>
    // Initialize icons
    lucide.createIcons();

    // Data and helper functions
    const TODAY = new Date("2025-10-06");
    
    function parseDateDMY(str) {
      if (!str || str === "—" || str === "sin vencimiento") return null;
      const parts = str.split("/");
      if (parts.length !== 3) return null;
      const d = parseInt(parts[0], 10), m = parseInt(parts[1], 10), y = parseInt(parts[2], 10);
      return new Date(y, m - 1, d);
    }
    
    function daysToExpire(item) {
      const d = parseDateDMY(item.venc);
      if (!d) return Infinity;
      return Math.ceil((d - TODAY) / (1000 * 60 * 60 * 24));
    }
    
    function vencClass(item) {
      const days = daysToExpire(item);
      if (days === Infinity) return "exp-safe";
      if (days <= 3) return "exp-red";
      if (days <= 7) return "exp-orange";
      if (days <= 30) return "exp-green";
      return "exp-safe";
    }
    
    function getStockStatus(item) {
      // Consideramos stock bajo si quedan menos de 5 kilos
      if (item.kilos < 5) return "status-low";
      if (item.kilos < 10) return "status-medium";
      return "status-good";
    }
    
    function escapeHtml(s) {
      return String(s).replace(/[&<>"']/g, c => ({'&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'}[c]));
    }

    // Inventory data with kilos and location
    const data = [
      // Cámara
      {producto: "Asado carnicero", kilos: 23.096, venc: "14/11/2025", ubicacion: "Cámara"},
      {producto: "Pollo Ganso", kilos: 11.174, venc: "14/11/2025", ubicacion: "Cámara"},
      {producto: "Huachalomo", kilos: 16.150, venc: "16/12/2025", ubicacion: "Cámara"},
      {producto: "Huachalomo", kilos: 6.800, venc: "14/11/2025", ubicacion: "Cámara"},
      {producto: "Lomo liso", kilos: 7.168, venc: "11/12/2025", ubicacion: "Cámara"},
      {producto: "Punta de paleta", kilos: 3.520, venc: "23/10/2025", ubicacion: "Cámara"},
      {producto: "Abastero", kilos: 3.170, venc: "23/10/2025", ubicacion: "Cámara"},
      {producto: "Filete", kilos: 2.200, venc: "23/10/2025", ubicacion: "Cámara"},
      {producto: "Lomo vetado", kilos: 6.800, venc: "23/01/2026", ubicacion: "Cámara"},
      {producto: "Asiento", kilos: 7.900, venc: "23/01/2026", ubicacion: "Cámara"},
      {producto: "Punta de ganso", kilos: 2.186, venc: "21/10/2025", ubicacion: "Cámara"},
      {producto: "Punta picana", kilos: 1.826, venc: "23/10/2025", ubicacion: "Cámara"},
      {producto: "Pechuga oferta", kilos: 11.450, venc: "27/02/2027", ubicacion: "Cámara"},
      {producto: "Pulpa de cerdo", kilos: 21.340, venc: "01/12/2026", ubicacion: "Cámara"},
      {producto: "Pollo trozado", kilos: 15.170, venc: "24/01/2027", ubicacion: "Cámara"},
      {producto: "Costilla de cerdo", kilos: 22.250, venc: "15/10/2025", ubicacion: "Cámara"},
      {producto: "Truto entero", kilos: 13.700, venc: "17/03/2027", ubicacion: "Cámara"},
      {producto: "Despunte para molida", kilos: 9.981, venc: "sin vencimiento", ubicacion: "Cámara"},
      {producto: "Costillar cerdo", kilos: 20.150, venc: "sin vencimiento", ubicacion: "Cámara"},
      {producto: "Prietas", kilos: 2.250, venc: "10/11/2025", ubicacion: "Cámara"},
      {producto: "Posta Paleta", kilos: 4.650, venc: "25/12/2025", ubicacion: "Cámara"},
      {producto: "Posta Paleta", kilos: 4.400, venc: "14/11/2025", ubicacion: "Cámara"},
      {producto: "Longaniza", kilos: 3.300, venc: "sin vencimiento", ubicacion: "Cámara"},
      {producto: "Entraña vacuno", kilos: 1.432, venc: "17/10/2025", ubicacion: "Cámara"},
      {producto: "Palanca", kilos: 2.990, venc: "06/11/2025", ubicacion: "Cámara"},
      {producto: "Poncho parrillero", kilos: 2.116, venc: "22/10/2025", ubicacion: "Cámara"},
      
      // Congelador Grande
      {producto: "Truto ala", kilos: 8.0, venc: "sin vencimiento", ubicacion: "Congelador Grande"},
      {producto: "Pechuga deshuesada", kilos: 9.0, venc: "sin vencimiento", ubicacion: "Congelador Grande"},
      {producto: "Costillar repasado", kilos: 7.700, venc: "sin vencimiento", ubicacion: "Congelador Grande"},
      {producto: "Lomo vetado cerdo", kilos: 9.170, venc: "13/05/2027", ubicacion: "Congelador Grande"},
      {producto: "Chuleta vetada", kilos: 19.400, venc: "sin vencimiento", ubicacion: "Congelador Grande"},
      {producto: "Lomo vetado cerdo", kilos: 10.029, venc: "14/05/2027", ubicacion: "Congelador Grande"},
      {producto: "Grasa de pella", kilos: 2.800, venc: "sin vencimiento", ubicacion: "Congelador Grande"},
      {producto: "Malaya cerdo", kilos: 10.934, venc: "sin vencimiento", ubicacion: "Congelador Grande"},
      {producto: "Grasa de cerdo", kilos: 3.244, venc: "sin vencimiento", ubicacion: "Congelador Grande"},
      {producto: "Entraña de cerdo", kilos: 5.900, venc: "sin vencimiento", ubicacion: "Congelador Grande"},
      
      // Congelador Chico
      {producto: "Pollo trozado", kilos: 15.550, venc: "24/01/2027", ubicacion: "Congelador Chico"},
      {producto: "Pechuga oferta", kilos: 15.210, venc: "27/02/2027", ubicacion: "Congelador Chico"},
      {producto: "Pechuga oferta", kilos: 15.170, venc: "27/02/2027", ubicacion: "Congelador Chico"},
      {producto: "Chuleta vetada", kilos: 16.810, venc: "04/04/2027", ubicacion: "Congelador Chico"},
      {producto: "Chuleta de centro", kilos: 14.900, venc: "12/07/2027", ubicacion: "Congelador Chico"},
      
      // Vitrina
      {producto: "Chuleta centro", kilos: 2.021, venc: "12/07/2027", ubicacion: "Vitrina"},
      {producto: "Longaniza", kilos: 3.074, venc: "sin vencimiento", ubicacion: "Vitrina"},
      {producto: "Pulpa cerdo", kilos: 11.028, venc: "sin vencimiento", ubicacion: "Vitrina"},
      {producto: "Chuleta vetada", kilos: 2.194, venc: "sin vencimiento", ubicacion: "Vitrina"},
      {producto: "Costillar repasado", kilos: 1.528, venc: "sin vencimiento", ubicacion: "Vitrina"},
      {producto: "Lomo vetado de cerdo", kilos: 1.968, venc: "sin vencimiento", ubicacion: "Vitrina"},
      {producto: "Aviones pollo", kilos: 1.850, venc: "sin vencimiento", ubicacion: "Vitrina"},
      {producto: "Truto ala", kilos: 2.302, venc: "sin vencimiento", ubicacion: "Vitrina"},
      {producto: "Pechuga deshuesada", kilos: 2.970, venc: "sin vencimiento", ubicacion: "Vitrina"},
      {producto: "Pechuga oferta", kilos: 2.604, venc: "sin vencimiento", ubicacion: "Vitrina"},
      {producto: "Truto entero", kilos: 3.614, venc: "sin vencimiento", ubicacion: "Vitrina"}
    ];

    // Initialize the application
    let currentList = [...data];
    let lastSortKey = null;
    let lastSortDir = 1;
    let chartBar, chartPie, chartLine, chartSales;

    // Initialize dashboard stats
    function initStats() {
      document.getElementById('total-products').textContent = data.length;
      document.getElementById('low-stock').textContent = data.filter(d => d.kilos < 5).length;
      document.getElementById('expiring-soon').textContent = data.filter(d => {
        const days = daysToExpire(d);
        return days !== Infinity && days < 15;
      }).length;
      document.getElementById('new-today').textContent = data.filter(d => d.ingresado).length;
    }

    // Render stock table
    function renderTable(list) {
      const tbody = document.getElementById('stockBody');
      tbody.innerHTML = "";
      
      list.forEach(item => {
        const tr = document.createElement('tr');
        const cls = vencClass(item);
        const statusClass = getStockStatus(item);
        const vencText = item.venc && item.venc !== "sin vencimiento" ? item.venc : "Sin vencimiento";
        
        tr.innerHTML = `
          <td>${escapeHtml(item.producto)}${item.ingresado ? ' <span style="color: #f59e0b;">⭐</span>' : ''}</td>
          <td>
            <div style="display: flex; align-items: center; gap: 8px;">
              <div style="width: 60px; height: 6px; background: #e2e8f0; border-radius: 3px; overflow: hidden;">
                <div style="height: 100%; width: ${Math.min(item.kilos / 25 * 100, 100)}%; background: ${item.kilos < 5 ? '#dc2626' : (item.kilos < 10 ? '#f59e0b' : '#059669')};"></div>
              </div>
              <span>${item.kilos.toFixed(3)} kg</span>
            </div>
          </td>
          <td class="${cls}">${vencText}${(item.venc && item.venc !== "sin vencimiento") ? ' (' + daysToExpire(item) + ' días)' : ''}</td>
          <td>${escapeHtml(item.ubicacion)}</td>
          <td><span class="status-badge ${statusClass}">${item.kilos < 5 ? 'Bajo' : (item.kilos < 10 ? 'Medio' : 'Bueno')}</span></td>
        `;
        tbody.appendChild(tr);
      });
    }

    // Sort table
    function sortTable(key) {
      if (lastSortKey === key) {
        lastSortDir = -lastSortDir;
      } else {
        lastSortDir = 1;
      }
      lastSortKey = key;
      
      currentList.sort((a, b) => {
        let va = a[key], vb = b[key];
        if (key === 'kilos') {
          va = a.kilos;
          vb = b.kilos;
        } else if (key === 'venc') {
          va = daysToExpire(a);
          vb = daysToExpire(b);
        }
        if (va === vb) return 0;
        return (va < vb ? -1 : 1) * lastSortDir;
      });
      
      renderTable(currentList);
      
      // Update sort indicators
      document.querySelectorAll('th').forEach(th => {
        th.classList.remove('sort-asc', 'sort-desc');
        if (th.dataset.key === key) {
          th.classList.add(lastSortDir === 1 ? 'sort-asc' : 'sort-desc');
        }
      });
    }

    // Filter table
    function filterTable(filter) {
      const chips = document.querySelectorAll('.chip');
      chips.forEach(chip => chip.classList.remove('active'));
      event.target.classList.add('active');
      
      if (filter === 'Todos') {
        currentList = [...data];
      } else {
        currentList = data.filter(item => item.ubicacion === filter);
      }
      
      renderTable(currentList);
    }

    // Initialize charts
    function initCharts() {
      // Bar chart - Top products by weight
      const topProducts = [...data]
        .sort((a, b) => b.kilos - a.kilos)
        .slice(0, 8);
      
      const ctxBar = document.getElementById('chartBar').getContext('2d');
      chartBar = new Chart(ctxBar, {
        type: 'bar',
        data: {
          labels: topProducts.map(p => p.producto),
          datasets: [{
            label: 'Kilos',
            data: topProducts.map(p => p.kilos),
            backgroundColor: topProducts.map(p => {
              const days = daysToExpire(p);
              if (days <= 7) return '#dc2626';
              if (days <= 30) return '#f59e0b';
              return '#059669';
            }),
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false },
            title: { display: true, text: 'Productos con Mayor Stock (kg)' }
          },
          scales: {
            y: { beginAtZero: true, title: { display: true, text: 'Kilos' } }
          }
        }
      });

      // Pie chart - Distribution by location
      const locationCounts = {};
      data.forEach(item => {
        locationCounts[item.ubicacion] = (locationCounts[item.ubicacion] || 0) + 1;
      });
      
      const ctxPie = document.getElementById('chartPie').getContext('2d');
      chartPie = new Chart(ctxPie, {
        type: 'pie',
        data: {
          labels: Object.keys(locationCounts),
          datasets: [{
            data: Object.values(locationCounts),
            backgroundColor: ['#1e40af', '#3b82f6', '#60a5fa', '#93c5fd']
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { position: 'bottom' },
            title: { display: true, text: 'Distribución por Ubicación' }
          }
        }
      });

      // Line chart - Consumption trend
      const ctxLine = document.getElementById('chartLine').getContext('2d');
      chartLine = new Chart(ctxLine, {
        type: 'line',
        data: {
          labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct'],
          datasets: [{
            label: 'Consumo (kg)',
            data: [120, 150, 180, 170, 160, 190, 210, 200, 220, 230],
            borderColor: '#1e40af',
            backgroundColor: 'rgba(30, 64, 175, 0.1)',
            tension: 0.3,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            title: { display: true, text: 'Evolución de Consumo Mensual' }
          },
          scales: {
            y: { beginAtZero: true, title: { display: true, text: 'Kilos' } }
          }
        }
      });

      // Sales chart
      const ctxSales = document.getElementById('chartSales').getContext('2d');
      chartSales = new Chart(ctxSales, {
        type: 'bar',
        data: {
          labels: ['Pulpa cerdo', 'Posta Paleta', 'Sobre costilla', 'Posta negra', 'Posta rosada'],
          datasets: [{
            label: 'Ventas (kg)',
            data: [85, 72, 68, 65, 60],
            backgroundColor: '#059669'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            title: { display: true, text: 'Productos Más Vendidos' }
          },
          scales: {
            y: { beginAtZero: true, title: { display: true, text: 'Kilos Vendidos' } }
          }
        }
      });
    }

    // Generate recommendations
    function generateRecs() {
      const recList = document.getElementById('recList');
      recList.innerHTML = '';
      
      // Check for products with low stock (sorted by kilos ascending)
      const lowStock = data.filter(p => p.kilos < 5)
        .sort((a, b) => a.kilos - b.kilos);
      
      if (lowStock.length > 0) {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <div class="card-header">
            <div class="card-title">Stock Bajo</div>
            <div class="status-badge status-low">${lowStock.length} productos</div>
          </div>
          <p>Los siguientes productos tienen stock bajo (ordenados de menor a mayor):</p>
          <ul>
            ${lowStock.map(p => `<li>${p.producto} - ${p.kilos.toFixed(3)} kg (${p.ubicacion})</li>`).join('')}
          </ul>
        `;
        recList.appendChild(card);
      }
      
      // Check for products expiring soon
      const expiring = data.filter(p => {
        const days = daysToExpire(p);
        return days !== Infinity && days < 15;
      });
      
      if (expiring.length > 0) {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <div class="card-header">
            <div class="card-title">Próximos a Vencer</div>
            <div class="status-badge status-medium">${expiring.length} productos</div>
          </div>
          <p>Los siguientes productos están próximos a vencer:</p>
          <ul>
            ${expiring.map(p => `<li>${p.producto} - ${p.venc} (${daysToExpire(p)} días)</li>`).join('')}
          </ul>
        `;
        recList.appendChild(card);
      }
      
      // Check for products with high stock (sorted by kilos descending)
      const highStock = data.filter(p => p.kilos > 20)
        .sort((a, b) => b.kilos - a.kilos);
      
      if (highStock.length > 0) {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <div class="card-header">
            <div class="card-title">Stock Alto</div>
            <div class="status-badge status-good">${highStock.length} productos</div>
          </div>
          <p>Los siguientes productos tienen stock alto (ordenados de mayor a menor):</p>
          <ul>
            ${highStock.map(p => `<li>${p.producto} - ${p.kilos.toFixed(3)} kg (${p.ubicacion})</li>`).join('')}
          </ul>
        `;
        recList.appendChild(card);
      }
      
      if (lowStock.length === 0 && expiring.length === 0 && highStock.length === 0) {
        recList.innerHTML = `
          <div class="card">
            <div class="card-header">
              <div class="card-title">Todo en Orden</div>
              <div class="status-badge status-good">OK</div>
            </div>
            <p>No se detectaron problemas críticos en el inventario actual.</p>
          </div>
        `;
      }
    }

    // Export to Excel function
    function exportToExcel() {
      // Create workbook and worksheet
      const wb = XLSX.utils.book_new();
      const ws = XLSX.utils.json_to_sheet(data.map(item => ({
        Producto: item.producto,
        Kilos: item.kilos,
        Vencimiento: item.venc,
        Ubicación: item.ubicacion,
        'Días para vencer': daysToExpire(item) === Infinity ? 'Sin vencimiento' : daysToExpire(item)
      })));
      
      // Add worksheet to workbook
      XLSX.utils.book_append_sheet(wb, ws, "Inventario");
      
      // Generate Excel file and trigger download
      XLSX.writeFile(wb, "inventario_camara_frigorifica.xlsx");
    }

    // Toggle accordion in summary section
    function toggleAccordion(type) {
      const accordion = document.getElementById(`accordion-${type}`);
      const isOpen = accordion.classList.contains('open');
      
      // Close all accordions
      document.querySelectorAll('.accordion').forEach(acc => {
        acc.classList.remove('open');
      });
      
      // Open the clicked one if it was closed
      if (!isOpen) {
        let items = [];
        
        switch(type) {
          case 'total':
            items = data;
            break;
          case 'low-stock':
            items = data.filter(d => d.kilos < 5);
            break;
          case 'expiring-soon':
            items = data.filter(d => {
              const days = daysToExpire(d);
              return days !== Infinity && days < 15;
            });
            break;
          case 'new-today':
            items = data.filter(d => d.ingresado);
            break;
        }
        
        accordion.innerHTML = `
          <ul>
            ${items.map(item => `
              <li>${item.producto} - ${item.kilos.toFixed(3)} kg - ${item.ubicacion}</li>
            `).join('')}
          </ul>
        `;
        
        accordion.classList.add('open');
      }
    }

    // Initialize the application
    function init() {
      initStats();
      renderTable(data);
      initCharts();
      generateRecs();
      
      // Set up event listeners
      document.querySelectorAll('.nav-item, .nav-btn').forEach(el => {
        el.addEventListener('click', () => {
          const tabId = el.dataset.tab;
          
          // Update active nav items
          document.querySelectorAll('.nav-item, .nav-btn').forEach(item => {
            item.classList.remove('active');
          });
          el.classList.add('active');
          
          // Update active tab
          document.querySelectorAll('.tab').forEach(tab => {
            tab.classList.remove('active');
          });
          document.getElementById(`tab-${tabId}`).classList.add('active');
          
          // Update title
          const titles = {
            graficos: 'Análisis Gráfico',
            stock: 'Control de Stock',
            recs: 'Alertas y Sugerencias',
            ventas: 'Ventas y Tendencias',
            resumen: 'Resumen General'
          };
          document.getElementById('title').textContent = titles[tabId];
        });
      });
      
      // Set up table sorting
      document.querySelectorAll('th[data-key]').forEach(th => {
        th.addEventListener('click', () => sortTable(th.dataset.key));
      });
      
      // Set up filtering
      document.querySelectorAll('.chip').forEach(chip => {
        chip.addEventListener('click', (e) => filterTable(e.target.dataset.filter));
      });
      
      // Set up Excel export button
      document.getElementById('exportExcelBtn').addEventListener('click', exportToExcel);
      
      // Set up hamburger menu
      document.getElementById('hamburgerBtn').addEventListener('click', (e) => {
        e.stopPropagation();
        document.getElementById('dropdownMenu').classList.toggle('active');
      });
      
      // Close dropdown when clicking outside
      document.addEventListener('click', () => {
        document.getElementById('dropdownMenu').classList.remove('active');
      });
      
      // Set up accordion for summary cards
      document.querySelectorAll('.stat-card').forEach(card => {
        card.addEventListener('click', () => {
          const type = card.dataset.type;
          toggleAccordion(type);
        });
      });
    }

    // Start the application
    init();
  </script>
</body>
</html>
